const CACHE="story-app-v1",API_CACHE="story-api-v1",STATIC=["/","/index.html"],BASE_URL="https://story-api.dicoding.dev/v1";self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE).then((e=>Promise.all(STATIC.map((t=>e.add(t).catch((()=>{})))))))),self.skipWaiting()})),self.addEventListener("activate",(e=>{const t=[CACHE,API_CACHE];e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>!t.includes(e))).map((e=>caches.delete(e))))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{new URL(e.request.url).origin===new URL(BASE_URL).origin?e.respondWith(fetch(e.request).then((t=>{if("GET"===e.request.method&&t.ok){const n=t.clone();caches.open(API_CACHE).then((t=>t.put(e.request,n)))}return t})).catch((()=>caches.match(e.request)))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request).then((t=>{if(t.ok&&"GET"===e.request.method){const n=t.clone();caches.open(CACHE).then((t=>t.put(e.request,n)))}return t})).catch((()=>caches.match("/index.html"))))))})),self.addEventListener("push",(e=>{const t=e.data.json(),n={title:t.title,options:{body:t.body}};self.registration.showNotification(n.title,n)})),self.addEventListener("notificationclick",(e=>{if(e.notification.close(),"close"===e.action)return;const t=e.notification.data?.url||"/#/home",n=e.notification.data?.storyId;e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(let i of e)if("focus"in i)return i.focus().then((()=>i.postMessage({action:"navigate",url:n?`/#/detail/${n}`:t})));return clients.openWindow(n?`/#/detail/${n}`:t)})))}));